# 面向对象分析与设计基础教程


节选自《UML2 面向对象分析与设计》。本章节所讨论的 UML 分析设计过程起始于业务建模，接下来是需求建模、用例分析、架构设计和构建设计，最后终止于代码实现。当然，这个过程并不是完整的软件开发过程（如缺少计划、管理、测试、维护等方面内容），因为这里重点讲解的是分析和设计。在实际的软件开发过程中，这些阶段可以是多次迭代重复的增量开发过程，而不一定是线性的顺序过程。

## 面向对象分析和设计工具-UML

[UML基础教程](work/methodology/Software-Engineering/UML基础教程.md)


## 业务建模

通过软件建模的方式，分析和理解待开发或者已有的业务，描述业务流程。**此阶段的目标是认识业务的现状，此阶段的理解是后续需求建模（用例建模）的基础。此阶段一般由产品经理负责。**

本阶段中主要使用扩展的 UML 用例图（Use Case Diagrams）进行业务建模，来描述整体业务，采用 UML 活动图（Activity Diagrams）或顺序图（Sequence Diagrams）来描述业务用例，进行业务流程的细化（或 User 之间的交互）。

如：自助点餐软件中，User 有服务员、食客、厨师等等，Use Case 有点餐、收拾餐桌、获取菜单等等，同时可以使用顺序图来描述各个 User 之间的依赖和交互关系；如银行交易系统，User 有储户、柜员、行长等，Use Case 有开户、存钱、取钱等，也**可以使用用例图（Use Case Diagrams）来描述 User-System 之间的关系，使用顺序图（Sequence Diagrams）来描述 User-System、User-User 之间的交互**。

对于软件工程师而言，业务建模只是辅助环节，并非每个项目、每个软件人员都要去实施该过程。当开发人员对于待处理业务非常熟悉，而业务本身也没有改进的必要时，就没有必要进行业务建模。当然，在很多软件项目开发的初期，通过业务建模可以帮助开发团队快速理解业务现状。

如，统一软件开发过程 RUP（Rational Unified Process） 方法中业务建模的**主要目标**：
1. 理解业务需求：通过与业务领域专家的合作，深入了解组织的业务需求，包括业务流程、业务规则、业务约束等。
2. 揭示业务流程和规则：通过建模工具和技术，识别和描述组织的业务流程和规则，包括业务活动、业务用例、业务规则等。
3. 发现问题和改进机会：通过业务建模的分析和讨论，识别业务流程中的问题、瓶颈和改进机会，为业务流程的优化提供依据。
4. 促进沟通和共识：通过业务建模的结果，促进开发团队和利益相关者之间的沟通和理解，确保对业务需求的一致性和共识。


业务建模的**主要任务**：
1. 使用用例图、活动图**描述目标组织的业务现状**，梳理业务组织的过程、角色和职责
2. 生成对应的**业务用例模型**、**业务对象模型**


### 业务用例模型

**业务用例**：描述了在业务流程中，业务节点与参与者之间的交互。

目标：**描述业务现状，描述业务组织与外部用户User，或者说组织外部业务参与者的交互**
组成元素：业务参与者、业务用例、业务用例描述
使用工具：
1. UML 用例图：描述业务参与者、业务用例，及其之间的关联关系
2. UML 活动图（带泳道的活动图）：描述具体的业务用例，PS：UML 活动图，即和流程图类似


### 业务对象模型

**业务对象**：是指代业务领域中的实体或概念，它们是在软件系统中进行处理和操作的主要对象，可以是某个人、某个事物（实体），或者某个抽象的概念。

目标：**描述业务现状，描述业务组织内部业务参与者的交互**
组成元素：业务工人、业务实体、业务用例实现
使用工具：
1. RUP类图


### 从业务模型到需求模型

对于业务模型中，每个需要实现的业务用例，在系统模型中都有一个或者多个系统用例，或者子系统与之对应。例如，在银行系统中，对于“存款”业务用例，可以确定一个“存款”系统用例来实现该业务，而对于相对复杂的“转账”业务，可能需要多个系统用例来实现，这些用例可以构成一个用例包，或者一个子系统。


## 需求建模（用例建模）

本阶段采用**UML用例图**（Use Case Diagrams）来进行**需求建模，也可以说是用例建模**，采用**用例文档**描述软件需求，作为后续用例分析的输入，**此阶段一般由产品经理、系统分析师等角色负责**。

**业务模型描述的是业务现状（Current Situation）**，而待开发的软件系统所要解决的问题一般并不等同于整个业务模型描述的所有业务，而是从业务模型中抽取提炼出来的需求，这个抽取过程就是需求建模的过程，**需求模型描述的用户的愿景（Vision）**。

传统的需求建模主要采用文字形式的需求规格说明书，并适当辅助一些功能分解图、IPO图等机制。UML提供的用例图，则是另外一种有效的需求建模手段，**用例建模的过程就是需求定义的过程，最终通过用例模型来表示目标业务模型的需求**。


### 获取需求

**系统分析师，除了需要通过业务模型，自行导出业务优化类的需求外，还需要和用户和业务深度接触，了解业务的原始需求。**

**即，一部分是自己看到的，一部分是别人说的**。


#### 通过资料和交流获取需求

1. 收集资料
2. 现场观察
3. 访谈：系统分析师与业务系统用户之间，或与业务相关人员进行的访谈
4. 开会
5. 原型：通过建立一个可进行虚拟交互的软件系统模型，来表达最终将要实现的软件系统的界面和功能等。通过这样的原型，在开发者和用户之间建立初步的一致认知，以便消除误解。
6. 问卷调查

#### 从业务模型中抽取需求

正如前文所述，业务模型描述了业务现状。在这些现状中，有些业务可能已经运转得很好了，不需要改进，也就没有必要作为需求，在系统中实现。而其他更多的业务，可能在运转过程中存在这样或者那样的问题，这些问题就可以成为业务待改进的改进点，也就可能转换为软件系统的需求。


**寻找业务改进点**

一般情况下，开发人员可以从以下4个方面来寻找业务的改进点，进而作为软件系统的需求。
1. 优化复杂的业务流程：业务复杂且冗长
2. 优化复杂的业务逻辑：业务节点复杂
3. 统一业务对象降低复杂度：将在多个业务流程中频繁使用的实体抽象为业务对象，统一规范
4. 自动化业务实现提效：某些要求定时、实时处理的业务，可以通过软件系统实现自动化进而提效

总结下来主要就是2点，一个是实现业务自动化，另一个是降低业务复杂度、和强化业务能力


#### 确定项目愿景

确定业务改进点只是第一步，并非所有的系统改进点后续都会转换为软件需求。用户可能会由于自身支付能力等因素，而选取部分的改进点，也就是用户的愿景（Vision），这是用户希望改进的内容，也是软件项目的目标。

愿景包含了待开发系统设定的目标和约束，代表了项目涉及的所有人达成的第一个共识，是项目核心需求的概览，为更详细的软件需求提供了契约型的依据，而软件开发团队则需要根据愿景（Vision）来指导后续的需求和设计。

一个好的愿景（Vision）应该包含以下5个特点：
1. 具体的（Specific）：愿景应该是具体的，包括业务问题的理想状态，以确保最后的实现是有意义的。
2. 相关的（Relevant）：愿景应该与待解决的问题强相关。
3. 可测量的（Measurable）：愿景应该是可测量的，故而项目团队可以确定项目的成功与否，以及是否满足既定目标。
4. 可实现的（Achievable）：在给定资源的前提下，愿景必须是可以实现的。虚假的愿景，只会导致项目失败，或者目标转变为蒙混过关。
5. 基于时间的（Time-based）：项目愿景应该必须存在deadline，无期限的项目只会使得团队缺少动力。


#### 确定软件系统需求

在确定项目愿景之后，就可以确定和导出软件需求。业务改进点中，被包含进项目愿景中的，即可以作为软件需求（如：某个业务流程的信息化、自动化等）。而不在项目愿景之中的改进点，则可以作为“潜在需求”归档。若后续客户有意提出新的愿景，则可以将“潜在需求”作为业务改进点，继续和客户商讨和确定。


### 理解需求

需求是客户可接受的、软件系统必须满足的条件或具备的能力。在软件开发中，用户常有不同类型的软件需求，RUP中给出了FURPS+的需求模型，该模型将需求分为以下几种类型。
1. 功能性（Functionality）：详细描述了系统必须有能力执行的动作，通过详细说明所期望的输入和输出条件来描述系统行为。
2. 可用性（Usability）：人为因素（审美学、易学性、易用性）和用户界面、用户文档、培训资料的一致性
3. 可靠性（Reliability）：主要包括故障的频率和严重性、输出结果的精确性、故障平均时间（Mean-Time-To-Failure，MTTF）、故障恢复能力和程序的可预见性。
4. 性能（Performance）
5. 可支持性（Supportabilitily）
6. 设计约束、接口需求、物理需求等、

**一般情况下功能需求之外的需求，统称为非功能性需求**。

需求工程主要包括定义需求、分析需求两个方面的活动。需求工程中的难点在于定义需求，需要联合多方参与者共同制定，沟通成本较大。


### 建立用例模型

**业务模型描述的是业务现状（Current Situation），需求模型描述的是用户关于系统的愿景（Vision）**。

用例建模一般由系统分析师负责。


#### 识别参与者

参与者指的是系统之外，与系统进行交互的事物。

参与者并不一定是个普通的人，任何一个事物（比如：鼠标、键盘等），都有可能成为系统的一个参与者。

参与者的定义要文档化。

#### 识别用例

用例是一个外部可见的系统功能单元，它是系统核心价值的提现，是整个系统功能需求的主体表现。

用例的识别和定义都是从参与者的角度出发的，因此可以**从参与者的视角出发，将其与软件系统的交互进行抽象概括，进而便能生成系统用例**。没有与软件系统交互，则不属于用例。

用例的特点：
1. 可观测性：用例描述的时参与者与系统的交互，而不是系统内在的活动，因此必须是可观测的。
2. 具备结果值：每个用例都会反馈给外部参与者一个有价值的结果。
3. 可交互性：用例需要由参与者执行。用例的定义应该采用业务语言，而不是使用软件语言（如数据库、Java等）。

**用例**是为了满足用户要求而提出来的用户目标，而**功能**则是为了实现用例目标需要提供的软件系统单元。

用例的名称，应该是“动宾”结构。

#### 绘制用例图

需求的用例图是用于在面向最终用户时，描述系统功能需求的。

其中参与者与用例质检的关联，使用实线连接，箭头由动作的主动方指向被动方。主动方，既可以是参与者，也可以是用例，即系统。

用例图中，“系统边界”并不是强制性要求，可以不进行绘制。


#### 用例建模实践

业务流程描述（可以通过业务模型、也可以通过文档）、识别参与者、识别用例、绘制用例图

### 编写用例文档

用例文档模板：
1. 用例名
2. 简要描述
3. 参与者
4. 涉众
5. 相关用例
6. 前置条件
7. 后置条件
8. 基本事件流
9. 备选事件流
10. 补充约束
11. 待解决问题
12. 相关图


### 重构用例模型

#### 用例拆解

初始用例模型中的用例一般都是彼此独立的，它们只与相关联的参与者之间存在关联关系，各个用例之间不存在任何交互。

然而在在各个用例之间，通常会存在一些相似甚至相同的步骤，还有一些用例可能包括一些独立的、可单独作为用例存在的事件流。在这些情况下，可以将原来复杂的用例，依据高内聚低耦合的规则，拆解为多个用例，用例之间存在一定的关系。

用例之间的关系，通常是以下三类：
包含关系：图例采用虚线+单向虚线箭头，并标识 `<<include>>`

扩展关系：图例采用虚线+单向虚线箭头，并标识 `<<extend>>
`
泛化关系：图例采用实线+单向空心三角箭头，无附加文字标识。


#### 用例分包


#### 用例分级



## 需求分析（用例分析）

采用UML用例分析技术分析软件需求，建立软件系统的分析模型。本阶段主要使用扩展的类图（Class Diagrams）来表示类之间的静态关系，采用通信图（Communication Diagrams）来表示动态交互。


## 面向对象的设计规范

[面向对象的设计规范](work/methodology/Software-Engineering/Analysis-and-Design/Object-Oriented-Design/面向对象的设计规范.md)


## 面向对象的设计模式

[面向对象的设计模式](work/methodology/Software-Engineering/Analysis-and-Design/Object-Oriented-Design/面向对象的设计模式.md)

## 架构设计（Architecture）

在系统的全局范围内，以分析模型为基础，设计系统组件的实现细节。本阶段和组件设计阶段，则主要采用包、构建、部署等图表示软件架构，采用类图、状态机图、时序图来进行详细的类设计。


支撑功能型需求的架构，即业务中的各项需求，主要是具体的软件应用
支撑非功能型需求的架构，如高可用、负载均衡、数据一致性等，主要是应用开发和运行平台


## 组件设计（Component）

本阶段根据架构设计的结果，将分析模型细化，设计系统组件的实现细节。

### 类和对象设计



## 从模型到代码实现

本阶段将系统组件映射到目标语言上，即根据类图、时序图、状态机图等生成代码。

### 正向工程


### 逆向工程


## 参考链接
1. [Wiki-Unified Modeling Language](https://en.wikipedia.org/wiki/Unified_Modeling_Language)
2. [UML2 Tutorial](https://sparxsystems.com/resources/tutorials/uml2/index.html)
3. 《UML2面向对象分析与设计（第2版）》-清华大学出版社
4. [Bilibili-北京航空航天大学-软件学院-UML2面向对象分析与设计](https://www.bilibili.com/video/BV1fq4y1q7KP)
5. [清华大学出版社-UML2面向对象分析与设计（第2版）-资源下载](http://www.tup.tsinghua.edu.cn/booksCenter/book_07138701.html#)
6. [阿里巴巴-Java开发手册(黄山版)](https://github.com/alibaba/p3c)