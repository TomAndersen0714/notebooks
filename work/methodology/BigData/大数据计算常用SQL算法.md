# 大数据计算常用SQL算法


## 去重计数

每次统计时，计算与统计时间点距离指定时间长度的起始时间点，到当前统计时间点之间的去重计数时，如果此时间窗口的长度固定，则是“固定时间窗口去重”，相反如果时间窗口的长度不固定，则称为“动态时间窗口去重”。

假设，指标统计时的时间维度粒度为d（天），统计周期为1d（即T+1统计），则指标“每天的近七天网页访问uv数”就属于“固定时间窗口去重”，即每天统计过去7天的去重计数。

而在“动态时间窗口去重”中，每次统计时，虽然时间窗口的结束时间点依旧是统计时间点，但起始时间点并不固定，可以是某固定范围内的任何一点，因此在“动态时间窗口去重”的指标计算中，每次统计时等价于要计算多个“固定时间窗口去重”的指标，此倍数等于最大的时间窗口长度。

### 固定时间窗口去重

假设，现需要统计“下单人数”，指标的时间维度的粒度为d（天），统计周期为1d，非时间维度包含省份、城市、和地区，且非时间维度需要支持不同维度的组合，即该指标存在多个不同的统计粒度。

#### 离线

数据量小：轻度汇总

数据量大：轻度汇总（可选）+按不同粒度去重聚合


#### 实时


### 动态时间窗口去重

以对应时间维度的粒度为分区（如：天），将当天视为时间窗口的结束时间，统计汇总粒度下


#### 离线


#### 实时



## 参考链接

1. https://blog.csdn.net/qq_36893938/article/details/124134575
2. https://help.aliyun.com/document_detail/410616.html
