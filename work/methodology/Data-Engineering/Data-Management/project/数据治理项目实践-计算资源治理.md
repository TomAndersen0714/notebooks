# 数据治理项目实践-计算资源治理

## 项目背景

由于业务早期发展迅猛，数仓集群的 CPU 和内存资源相对充足，未提前应对潜在计算资源问题，随着任务计算资源竞争、数据实时性不断下降等问题的不断累计，导致数据下游开始出现投诉，以及计算资源紧缺，频繁触发水位线告警。

到了业务增速放缓，基建完善后，回过头来看需要做大面积降本，需要对计算资源进行专项治理，降低计算资源成本，提升数据的实时性，保证 SLA。

## 项目分析

### 需求分析

搜集并了解利益相关者的需求和期望，以便有效沟通。

### 可行性分析

1. 创建 MVP 最小可行性产品进行项目的可行性的 POC 概念验证
2. 收集整理 POC 阶段中遇见的各种问题，提前做好风险把控
3. 后续在立项成功之后，再进行扩大再生产，同时解决 POC 过程中遇见的各种问题

### 预期收益

1. 基于 POC 结束后的收益，预测扩大再生产之后产生的收益
2. 梳理预期收益时
	1. 微观上，需要列出所有的收益人，明确现状、预期，及两者之间的收益
		1. 对内
		2. 对外
	2. 宏观上，需要列出集体的预期收益
		1. 对部门
		2. 对公司

## 项目设计

### 项目目标

阶段目标，到 xxx 时间完成 xxx 内容
最终目标，降低多少成本

### 项目计划

1. 基础工具开发
	1. 元数据采集工具
		1. 数据平台内置、开源工具采集、平台或者工具二开
		2. CDH 内置元数据图标库，以及元数据查询
		3. ClickHouse 内置系统表
	2. 元数据监控和通知工具
		1. Airflow 通知 Feishu 工具
		2. ETL 任务定期统计
	3. 性能问题诊断工具
		1. Explain 的结果丢给 AI，让 AI 帮忙进行初步诊断，提示优化方向
2. 元数据采集
	1. 查询日志
3. 元数据分析，识别和定位问题
	1. YARN Application 的 CPU、内存开销等
	2. Spark SQL (Spark Application) 的 Task 数、读取数据量等
	3. Hive SQL 的 Map Task 数、Reduce Task 数、读取数据量等等
	4. AI 依据 Explain 辅助诊断 (AI 的作用在于提供大致的方向，但路你得自己走)
4. 设计方案，优化和解决问题
	1. 高资源开销任务性能优化，[Spark-SQL性能优化基础教程](work/component/Big-Data/Apache-Spark/library/SparkSQL/Spark-SQL性能优化基础教程.md)
		1. 数据倾斜优化
		2. 查询条件优化
	2. 小文件合并
	3. 调度时间分布优化
		1. 避免任务调度出现拥挤，提升资源利用率
		2. 避免核心任务出现 SLA 破线
	4. 计算任务资源参数调整
		1. 队列、core、Memory
5. 元数据监控，避免问题复发
6. 项目成果阶段性总结

## 项目实施

项目进度管理
项目质量管理
项目变更管理

## 项目交付

项目价值总结
1. 通过小文件合并，减少了文件数量 xx 个，占比 xx%，降低了 NameNode 内存 xx GB，占比 xx %
2. 通过针对高 CPU  时间和内存开销任务进行性能优化，减少 CPU 资源开销开销 xx `core*time` 占比 xx %，减少内存开销 xx GB，占比 xx %
3. 通过基于任务资源开销，合理调整资源参数，减少 CPU 资源开销开销 xx `core*time` 占比 xx %，减少内存开销 xx GB，占比 xx %
4. 通过调整任务调度时间，削峰填谷，实现 CPU 使用率峰值降低 xx %，内存使用率峰值降低 xx %
5. 通过合并重复计算任务，减少 CPU 资源开销开销 xx `core*time` 占比 xx %，减少内存开销 xx GB，占比 xx %
6. 总计，减少 CPU 资源开销开销 xx `core*time`，占比 xx %，减少内存开销 xx GB，占比 xx %

项目价值输出
1. 文档
2. PPT

## 项目复盘

流程复盘

## 参考链接

1. [知识星球 | 深度连接铁杆粉丝，运营高品质社群，知识变现的工具](https://articles.zsxq.com/id_ektnjwuuomn4.html)
2. [知识星球 | 深度连接铁杆粉丝，运营高品质社群，知识变现的工具](https://articles.zsxq.com/id_lubws2j0wfw4.html)
3. [微信公众平台 - 数据治理实践 | 网易某业务线的计算资源治理](https://mp.weixin.qq.com/s?__biz=MzIwNTUxNTI1Ng==&mid=2247490169&idx=1&sn=3ecc7a883cae410c5365fc4507fcc57d&scene=21#wechat_redirect)