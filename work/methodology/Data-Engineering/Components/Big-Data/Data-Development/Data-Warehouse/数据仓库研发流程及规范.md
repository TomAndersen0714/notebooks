# 数据仓库研发流程及规范


## 数据仓库研发规范概述


## 需求阶段

数据探查


## 设计阶段

数据集成：数据ETL


数仓搭建：数仓开发


数据消费：
1. 数据查询接口开发
2. 数据查询结果可视化


## 开发阶段


不可加性指标，应改拆解为可加性指标


## 测试阶段


功能测试
性能测试

先自测，后提交测试


### BUG排查流程

BUG的定义：BUG指的是，程序设计上的错误，通常表现在算法和数据等方面，使得程序的结果和预期不符。在功能上的表现就是，**程序的运行结果，和需求文档中的需求定义不符**。

排查流程的主体思想：自顶向下，对比基准，抽丝剥茧

#### 定位：定位指标异常值对应的具体行记录
如：在数据可视化界面上，粒度通常等价于筛选条件，即维度的组合，通过筛选条件，可以定位到异常指标的具体行记录


#### 重现：测服使用指标异常值依赖的基础数据重现BUG
抽取线上对应异常指标，在指定粒度下，直接依赖的所有数据（包括明细和维度数据，但仅抽取直接依赖的），将线上明细数据抽取到测服，回放对应任务，重现问题，还原线上环境。


#### 对比：确定对应的基准值并对比两者的算法和基础数据
通过OLAP即席查询系统，对比基准值和异常值之间的算法和基础数据，并抽取和生成Bad Case。

**和自己比的异常**，如：发现指标波动异常，则比较对象是上一周期产生的指标值，而先对比两者的算法，如果算法一致，则可以使用关联查询（JOIN）对比其基础数据（明细数据、维度数据）

**和其他比的异常**，如：发现两个类似的指标之间，数值差别巨大，则将其中的一个指标值视为基准值，另一个指标值视为异常值，先对比两者的算法，如果算法一致，则可以使用关联查询（JOIN）对比其基础数据（明细数据、维度数据）

通过对比各个Bad Case，可以确定指标是否真实存在异常。


#### 下钻：排查指标统计算法，以及基础数据ETL算法
通过重现和对比，发现指标的值确实存在异常后，则需要定位具体问题是在于统计算法，还是指标的基础数据ETL算法，亦或是基础数据的数据质量。

通过对比中抽取出的Bad Case，逐步分析完整的ETL链条，定位BUG点。



### 数仓BUG常见原因

数据查询和可视化问题


统计表计算逻辑问题


明细表计算逻辑问题


数据质量问题


## 发布阶段


## 运维阶段

开发人员根据需求将代码发布上线后，还需要及时处理数据、程序、调度、监控告警等的异常事件，保障数据产出时效、程序高效运行和生产稳定。


其中在“运维阶段”的“获取异常”阶段，可能是通过`运维人员`发现指标监控、计算任务、服务等出现异常，及时抛出并传递给`开发人员`，也可能是上层`业务人员`发现指标结果和需求描述不符，确定是BUG后，向下反馈并传递给`开发人员`的。


### 异常处理流程

#### 系统告警


#### 业务反馈

##### 确定异常原因是BUG，还是功能不符合客户心理预期

`测试人员`，通过排查随机抽样等方式，来判断数据计算逻辑是否符合需求文档中对于需求的定义，如果不符合，则属于BUG；如果符合，则代表异常原因是功能不符合客户心理预期。


##### 如果是BUG，则走BUG排查流程
问题原因通常在于研发人员、测试人员，又或者是需求描述没有对齐
1. 产品经理和研发、测试之间需求定义没有对齐
2. 研发人员未能按照需求文档实现对应的功能
3. 测试人员测试不够严谨


##### 如果是不符合客户心理预期，则走需求变更流程
问题原因通常在于产品经理，事先未清晰对接客户需求


## 参考链接
1. [大数据开发治理平台 DataWorks-研发规范](https://help.aliyun.com/document_detail/115489.html)
2. [大数据开发治理平台 DataWorks-研发规范.pdf](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/download%2Fpdf%2F115489%2F%25E7%25A0%2594%25E5%258F%2591%25E8%25A7%2584%25E8%258C%2583_cn_zh-CN.pdf)